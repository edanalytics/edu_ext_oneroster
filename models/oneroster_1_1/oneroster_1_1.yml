version: 2
models:
  - name: or1_1__manifest
    config: 
      tags: ['oneroster_1.1']
  - name: or1_1__academic_sessions
    config: 
      tags: ['oneroster_1.1']
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - sourcedId 
            - TENANT_CODE
          quote_columns: true
    columns: 
      - name: type
        quote: true 
        tests: 
          - accepted_values: 
              values: ['gradingPeriod', 'semester', 'schoolYear', 'term']
  - name: or1_1__classes
    config: 
      tags: ['oneroster_1.1']
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - sourcedId 
            - TENANT_CODE
          quote_columns: true
    columns: 
      - name: courseSourcedId
        quote: true
        tests:
          - relationships:
              to: ref('or1_1__courses')
              field: '"sourcedId"'
      - name: schoolSourcedId
        quote: true
        tests:
          - relationships: 
              to: ref('or1_1__orgs')
              field: '"sourcedId"'
      - name: classType
        quote: true 
        tests: 
          - accepted_values: 
              values: ['homeroom', 'scheduled']
  - name: or1_1__courses
    config: 
      tags: ['oneroster_1.1']
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - sourcedId 
            - TENANT_CODE
          quote_columns: true
    columns: 
      - name: orgSourcedId
        quote: true
        tests:
          - relationships: 
              to: ref('or1_1__orgs')
              field: '"sourcedId"'
      - name: schoolYearSourcedId
        quote: true
        tests:
          - relationships: 
              to: ref('or1_1__academic_sessions')
              field: '"sourcedId"'
  - name: or1_1__enrollments
    config: 
      tags: ['oneroster_1.1']
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - sourcedId 
            - TENANT_CODE
          quote_columns: true
    columns: 
      - name: classSourcedId
        quote: true
        tests:
          - relationships: 
              to: ref('or1_1__classes')
              field: '"sourcedId"'
      - name: schoolSourcedId
        quote: true
        tests:
          - relationships: 
              to: ref('or1_1__orgs')
              field: '"sourcedId"'
      - name: userSourcedId
        quote: true
        tests:
          - relationships: 
              to: ref('or1_1__users')
              field: '"sourcedId"'
  - name: or1_1__orgs
    config: 
      tags: ['oneroster_1.1']
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - sourcedId 
            - TENANT_CODE
          quote_columns: true
    columns: 
      - name: type
        quote: true 
        tests: 
          - accepted_values: 
              values: ['department', 'school', 'district', 'local', 'state', 'national']
  - name: or1_1__users
    config: 
      tags: ['oneroster_1.1']
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - sourcedId 
            - TENANT_CODE
          quote_columns: true
    columns: 
      - name: role
        quote: true 
        tests: 
          - accepted_values: 
              values: ['administrator', 'aide', 'guardian', 'parent', 'proctor', 'relative', 'student', 'teacher']